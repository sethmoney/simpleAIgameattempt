<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Power-Up Collection Game with Enhanced Mechanics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>body { margin: 0; padding: 0; overflow: hidden; }</style>
</head>
<body>
    <script>
        let playerPosition;
        let playerSize = 20; // Default player size
        let powerUps = [];
        let powerUpSize = 15;
        let inventory = {};
        let showInventory = false;
        let isBluePowerUpActive = false;
        let bluePowerUpDuration = 300; // Adjusted duration for using multiple blue power-ups
        let bluePowerUpTimer = 0;
        let score = 0;
        let timer; // Timer for countdown
        let timerDuration = 600; // 10 seconds * 60 fps
        let isGreenPowerUpActive = false;
        let greenPowerUpDuration = 300; // Duration in frames
        let greenPowerUpTimer = 0;
        let velocityBoost = 15; // The amount by which the velocity is multiplied


        function setup() {
            createCanvas(800, 600);
            playerPosition = createVector(width / 2, height / 2);
            addPowerUps(5); // Initial set of power-ups
            timer = timerDuration; // Initialize the timer
        }

        function draw() {
            background(0);
            handlePlayerInput();
            if (isBluePowerUpActive) {
                bluePowerUpTimer--;
                if (bluePowerUpTimer <= 0) {
                    isBluePowerUpActive = false;
                    playerSize = 20; // Reset to original size after effect wears off
                }
            }
            // Check for Green Power-Up Active State and its Duration
            if (isGreenPowerUpActive && greenPowerUpTimer > 0) {
                greenPowerUpTimer--;
                if (greenPowerUpTimer <= 0) {
                    isGreenPowerUpActive = false; // Effectively stops the velocity boost
                }
            }
            drawPlayer();
            drawPowerUps();
            updateAndDisplayTimer(); // Update and display the timer
            if (showInventory) {
                drawInventory();
            }
            drawScoreboard(); // Call to draw the scoreboard
            maybeAddPowerUp(); // Add more power-ups over time
        }

        function keyPressed() {
            if (key === 'i' || key === 'I') {
                showInventory = !showInventory;
            } else if (key === '1') {
                usePowerUp('blue');
            }
        }

        function handlePlayerInput() {
            let speed = 5; // Base speed
            // Increase speed if green power-up is active
            if (isGreenPowerUpActive) {
                speed *= velocityBoost;
            }
            if (keyIsDown(87)) { // W
                playerPosition.y -= speed; // Use 'speed' instead of a fixed value
            }
            if (keyIsDown(83)) { // S
                playerPosition.y += speed; // Use 'speed' instead of a fixed value
            }
            if (keyIsDown(65)) { // A
                playerPosition.x -= speed; // Use 'speed' instead of a fixed value
            }
            if (keyIsDown(68)) { // D
                playerPosition.x += speed; // Use 'speed' instead of a fixed value
            }
            // Wrap around screen edges
            if (playerPosition.y < 0) playerPosition.y = height;
            if (playerPosition.y > height) playerPosition.y = 0;
            if (playerPosition.x < 0) playerPosition.x = width;
            if (playerPosition.x > width) playerPosition.x = 0;
        }

        function drawPlayer() {
            fill(255);
            ellipse(playerPosition.x, playerPosition.y, playerSize, playerSize);
        }

        function drawPowerUps() {
            powerUps.forEach((powerUp, index) => {
                if (!powerUp.collected) {
                    fill(powerUp.color);
                    ellipse(powerUp.position.x, powerUp.position.y, powerUpSize, powerUpSize);
                    if (dist(playerPosition.x, playerPosition.y, powerUp.position.x, powerUp.position.y) < playerSize / 2 + powerUpSize / 2) {
                        powerUp.collected = true;
                         // Check for green power-up and activate velocity boost
                        if (powerUp.color === 'green') {
                            isGreenPowerUpActive = true;
                            greenPowerUpTimer = greenPowerUpDuration;
                        }
                        inventory[powerUp.color] = (inventory[powerUp.color] || 0) + 1;
                        if (powerUp.color === 'purple') {
                            timer += 180; // Add 3 seconds to the timer
                        }
                        if (powerUp.color === 'yellow') {
                            score++; // Increase score for yellow circles
                        }
                    }
                }
            });
        }

        function drawScoreboard() {
            fill(255);
            textSize(32);
            textAlign(CENTER, TOP);
            text(`Score: ${score}`, width / 2, 10);
        }
        
        function drawInventory() {
            let inventoryX = playerPosition.x + 40; // Offset from player
            let inventoryY = playerPosition.y - 50; // Adjusted for visibility
            fill(255, 255, 255, 150); // Semi-transparent white for background
            let inventoryWidth = 120;
            let inventoryHeight = 20 + Object.keys(inventory).length * 20;
            rect(inventoryX, inventoryY, inventoryWidth, inventoryHeight); // Dynamic height based on inventory size
            fill(0); // Text color
            textSize(12); // Adjust text size as needed
            let textOffsetY = 15;
            Object.entries(inventory).forEach(([color, count], index) => {
                text(`${color.toUpperCase()}: ${count}`, inventoryX + 10, inventoryY + textOffsetY + index * 20);
            });
        }

        function usePowerUp(color) {
            if (color === 'blue' && inventory[color] && inventory[color] > 0) {
                playerSize += inventory[color] * 5; // Increase size based on blue power-ups collected
                bluePowerUpTimer = bluePowerUpDuration + (inventory[color] * 10); // Optional: Increase duration based on power-ups used
                inventory[color] = 0; // Use up all blue power-ups
                isBluePowerUpActive = true;
            }
        }

        function addPowerUps(count) {
            const colors = ['blue', 'red', 'yellow', 'green', 'purple'];
            for (let i = 0; i < count; i++) {
                powerUps.push({
                    position: createVector(random(width), random(height)),
                    color: random(colors),
                    collected: false
                });
            }
        }

        function maybeAddPowerUp() {
            if (frameCount % 60 === 0) {
                addPowerUps(1);
            }
        }

        function updateAndDisplayTimer() {
            if (timer > 0) {
                timer--;
                let seconds = timer / 60;
                fill(255);
                textSize(32);
                textAlign(CENTER, BOTTOM);
                text(`Time: ${seconds.toFixed(1)}`, width / 2, height - 10);
            }
        }
    </script>
</body>
</html>
